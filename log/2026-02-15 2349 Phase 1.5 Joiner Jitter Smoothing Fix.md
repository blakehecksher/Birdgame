# 2026-02-15 2349 - Phase 1.5 Joiner Jitter Smoothing Fix

## Summary

Implemented a joiner-focused smoothing pass ("Phase 1.5") after Phase 1 to eliminate remaining client-side jitter for the non-host player.

Result from live user retest:
"Hell yes! This is perfect! This feels so smooth!"

---

## Problem Context

Phase 1D removed the major mesh update ordering bug and improved joiner smoothness significantly, but slight residual jitter remained for the joining player during active movement.

Key remaining issue:
- Soft reconciliation was still applying frequent simulation corrections that could leak through as visual micro-step pullbacks.
- Soft reconciliation was also blending local rotation toward delayed authority, which risks camera feel instability during turning/climbing/diving.

---

## Chosen Fix Path

Selected a camera-safe reconciliation strategy:
- Keep host authority and existing hard-snap behavior.
- Keep soft reconciliation for simulation correctness.
- Decouple visual presentation from soft correction deltas.

This path was chosen over immediate throttle rollback because it preserves fast desync recovery while removing visible tugging for normal movement.

---

## Implementation Details

### 1. Visual Reconciliation Offset (new)

Added a local visual-only offset buffer:
- `localVisualReconciliationOffset`
- `reconciliationScratch` (temporary vector to avoid extra allocations)

Local mesh now renders at:
- `meshPosition = simulatedPosition + visualOffset`

The visual offset decays toward zero each frame.

### 2. Soft Reconciliation behavior updated

Soft reconciliation now:
- Reconciles `position` and `velocity` only.
- Does **not** apply soft rotation reconciliation.
- Accumulates the correction delta into the visual offset buffer.
- Clamps visual offset magnitude to avoid runaway divergence.

### 3. Hard Snap behavior preserved

Hard snap still:
- Copies authoritative position, velocity, and rotation.
- Updates mesh immediately.
- Clears visual offset to avoid stale correction artifacts.

### 4. Offset resets at lifecycle boundaries

Visual offset is reset:
- On local player creation/spawn.
- On round-start spawn application.
- On hard snap events.

---

## Files Changed

1. `src/config/constants.ts`
- Added `RECONCILIATION_VISUAL_OFFSET_DAMPING: 12.0`
- Added `RECONCILIATION_VISUAL_OFFSET_MAX: 1.0`

2. `src/core/Game.ts`
- Added visual offset state fields.
- Applied visual offset during local mesh update.
- Added per-frame damping of visual offset.
- Updated `reconcileLocalPlayerWithAuthority()` soft path to:
  - reconcile position/velocity only,
  - skip soft rotation reconciliation,
  - accumulate correction delta into visual offset.
- Preserved hard snap full correction.
- Reset offset on spawn/round lifecycle points.

---

## Validation

Automated checks after implementation:
- `npm test`: 30/30 passing
- `npm run build`: success

Live user validation:
- Joiner movement now reported as smooth and fixed.

---

## Outcome

Phase 1.5 successfully removed the remaining visible joiner jitter while keeping host-authoritative netcode and fast desync correction behavior intact.

Status: Complete and user-validated.

